{% extends 'BackendBundle::layout.html.twig' %}

{% block custom_css %}
    {{ parent() }}

    <!-- select2 Styles -->
    <link rel="stylesheet" href="{{ asset('bundles/backend/css/plugins/select2/select2.min.css') }}"
          type="text/css"/>

    <!-- selectize Styles -->
    <link rel="stylesheet" href="{{ asset('bundles/backend/css/plugins/selectize/selectize.css') }}"
          type="text/css"/>
    <link rel="stylesheet" href="{{ asset('bundles/backend/css/plugins/selectize/selectize.default.css') }}"
          type="text/css"/>

    <!-- iCkeck Styles -->
    <link rel="stylesheet" href="{{ asset('bundles/backend/css/plugins/iCheck/custom.css') }}"
          type="text/css">

    <!-- Summernote Styles -->
    <link rel="stylesheet" href="{{ asset('bundles/backend/css/plugins/summernote/summernote.css') }}"
          type="text/css">
    <link rel="stylesheet" href="{{ asset('bundles/backend/css/plugins/summernote/summernote-bs3.css') }}"
          type="text/css">

{% endblock %}

        {% block active_mails %}active{% endblock %}

        {% block page_heading_title %}
            {{ 'Send Mail' | trans({}, 'mailsbackend') }}
        {% endblock %}

        {% block page_heading_action_button %}
            <div class="pull-right title-action">
                <a href="{{ path('backend_homepage') }}" class="btn btn-danger btn-sm" data-toggle="tooltip"
                   data-placement="top" title="Discard email">
                    <i class="fa fa-times"></i> {{ 'Discard' | trans({}, 'mailsbackend') }}
                </a>
            </div>
        {% endblock %}

        {% block page_content %}

            {{ form_start(form, {'attr': {'class':'form-horizontal'}}) }}

            <div class="mail-box">

                <div class="mail-body">

                    <div class="form-group{% if(form.registeredUsers.vars['errors']|length > 0) %} {{ ' has-error' }} {% endif %}">
                        <label for=""
                               class="col-md-2 control-label">{{ form_label(form.registeredUsers) }}</label>

                        <div class="col-md-6">
                            {{ form_widget(form.registeredUsers, { 'attr': {
                                'class' : 'form-control select2-field-registered',
                                'style' : 'width: 100%'}}) }}
                            {% if form.registeredUsers.vars['errors']|length > 0 %}
                                <ul class="message">
                                    {% for error in form.registeredUsers.vars['errors'] %}
                                        <li>{{ error.message }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </div>
                    </div>
                    <div class="hr-line-dashed"></div>

                    <div class="form-group{% if(form.subscribedUsers.vars['errors']|length > 0) %} {{ ' has-error' }} {% endif %}">
                        <label for=""
                               class="col-md-2 control-label">{{ form_label(form.subscribedUsers) }}</label>

                        <div class="col-md-6">
                            {{ form_widget(form.subscribedUsers, { 'attr': {
                                'class' : 'form-control select2-field-subscribed',
                                'style' : 'width: 100%'}}) }}
                            {% if form.subscribedUsers.vars['errors']|length > 0 %}
                                <ul class="message">
                                    {% for error in form.subscribedUsers.vars['errors'] %}
                                        <li>{{ error.message }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </div>
                    </div>
                    <div class="hr-line-dashed"></div>

                    <div class="form-group{% if(form.customAddresses.vars['errors']|length > 0) %} {{ ' has-error' }} {% endif %}">
                        <label for=""
                               class="col-md-2 control-label">{{ form_label(form.customAddresses) }}</label>

                        <div class="col-md-6">
                            {{ form_widget(form.customAddresses, { 'attr': {
                                'class' : 'selectize-custom-address',
                                'placeholder' : 'Write some addresses ...' | trans({}, 'mailsbackend') }}) }}
                            {% if form.customAddresses.vars['errors']|length > 0 %}
                                <ul class="message">
                                    {% for error in form.customAddresses.vars['errors'] %}
                                        <li>{{ error.message }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </div>
                    </div>
                    <div class="hr-line-dashed"></div>

                    <div class="form-group{% if(form.groupOfUsers.vars['errors']|length > 0) %} {{ ' has-error' }} {% endif %}">
                        <label for=""
                               class="col-md-2 control-label">{{ form_label(form.groupOfUsers) }}</label>

                        <div class="col-md-6">
                            {{ form_widget(form.groupOfUsers, { 'attr': {
                                'class' : 'form-control select2-field-group',
                                'style' : 'width: 100%'}}) }}
                            {% if form.groupOfUsers.vars['errors']|length > 0 %}
                                <ul class="message">
                                    {% for error in form.groupOfUsers.vars['errors'] %}
                                        <li>{{ error.message }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </div>
                    </div>
                    <div class="hr-line-dashed"></div>

                    <div class="form-group{% if(form.categories.vars['errors']|length > 0) %} {{ ' has-error' }} {% endif %}">
                        <label for=""
                               class="col-md-2 control-label">{{ form_label(form.categories) }}</label>

                        <div class="col-md-6">
                            {{ form_widget(form.categories, { 'attr': {
                                'class' : 'form-control select2-field-category',
                                'style' : 'width: 100%'}}) }}
                            {% if form.categories.vars['errors']|length > 0 %}
                                <ul class="message">
                                    {% for error in form.categories.vars['errors'] %}
                                        <li>{{ error.message }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </div>
                    </div>
                    <div class="hr-line-dashed"></div>

                    <div class="form-group{% if(form.deals.vars['errors']|length > 0) %} {{ ' has-error' }} {% endif %}">
                        <label for=""
                               class="col-md-2 control-label">{{ form_label(form.deals) }}</label>

                        <div class="col-md-6">
                            {{ form_widget(form.deals, { 'attr': {
                                'class' : 'form-control select2-field-deals',
                                'style' : 'width: 100%'}}) }}
                            {% if form.deals.vars['errors']|length > 0 %}
                                <ul class="message">
                                    {% for error in form.deals.vars['errors'] %}
                                        <li>{{ error.message }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}
                        </div>
                    </div>

                </div>

                <div class="mail-text h-200">

                    <div class="form-group{% if(form.message.vars['errors']|length > 0) %} {{ ' has-error' }} {% endif %}">
                        <div class="col-md-12">

                            {% if form.message.vars['errors']|length > 0 %}
                                <ul class="message">
                                    {% for error in form.message.vars['errors'] %}
                                        <li>{{ error.message }}</li>
                                    {% endfor %}
                                </ul>
                            {% endif %}

                            <div class="hidden">
                                <h3>Hello Jonathan! </h3>
                                dummy text of the printing and typesetting industry. <strong>Lorem Ipsum has been the
                                    industry's</strong> standard dummy text ever since the 1500s,
                                when an unknown printer took a galley of type and scrambled it to make a type specimen
                                book. It
                                has survived not only five centuries, but also the leap into electronic
                                typesetting, remaining essentially unchanged. It was popularised in the 1960s with the
                                release
                                of Letraset sheets containing Lorem Ipsum passages, and more recently with
                                <br/>
                                <br/>

                            </div>

                            {{ form_widget(form.message, { 'attr': {
                                'class' : 'form-control large-height summernote',
                                'placeholder' : 'Write your message here ...' | trans({}, 'mailsbackend') }}) }}
                        </div>
                    </div>
                    <div class="clearfix"></div>
                </div>

                <div class="mail-body text-left tooltip-demo">
                    <a title="{{ 'Dashboard' | trans({}, 'mailsbackend') }}" class="btn btn-success"
                       href="{{ path('backend_homepage') }}" data-toggle="tooltip" data-placement="top">
                        <span class="fa fa-th-large"></span>
                        {{ 'Dashboard' | trans({}, 'mailsbackend') }}
                    </a>
                    <button title="{{ 'Send' | trans({}, 'mailsbackend') }}" id="btn-mails-send" class="btn btn-primary"
                            type="submit" data-toggle="tooltip" data-placement="top">
                        <span class="fa fa-send"></span> {{ 'Send' | trans({}, 'mailsbackend') }}
                    </button>
                </div>

                <div class="clearfix">
                    {{ form(form) }}
                </div>

            </div>

            {{ form_end(form) }}

        {% endblock %}

    {% block custom_js %}
        {{ parent() }}

        <!-- select2 Scripts -->
        <script src="{{ asset('bundles/backend/js/plugins/select2/select2.full.min.js') }}"
                type="text/javascript"></script>
        <!-- selectize Scripts -->
        <script src="{{ asset('bundles/backend/js/plugins/selectize/selectize.min.js') }}"
                type="text/javascript"></script>
        <!-- iCheck Scripts -->
        <script src="{{ asset('bundles/backend/js/plugins/iCheck/icheck.min.js') }}"
                type="text/javascript"></script>
        <!-- Summernote Scripts -->
        <script src="{{ asset('bundles/backend/js/plugins/summernote/summernote.min.js') }}"
                type="text/javascript"></script>
    {% endblock %}

    {% block inline_js %}
        <script type="text/javascript">

            $(document).ready(function () {

                //  select2 scripts for select2 addresses field
                $(".select2-field-registered").select2({
                    placeholder: "-- {{ 'SELECT ADDRESSES' | trans({}, 'mailsbackend') }} --"
                });

                //  select2 scripts for select2 addresses field
                $(".select2-field-subscribed").select2({
                    placeholder: "-- {{ 'SELECT ADDRESSES' | trans({}, 'mailsbackend') }} --"
                });

                //  selectize scripts for tags
                $(".selectize-custom-address").selectize({
                    plugins: ['remove_button', 'restore_on_backspace'],
                    delimiter: ';',
                    persist: false,
                    create: true
                });

                //  select2 scripts for select2 fields
                $(".select2-field-group").select2();

                //  select2 scripts for select2 category field
                $(".select2-field-category").select2({
                    placeholder: "-- {{ 'SELECT CATEGORY' | trans({}, 'mailsbackend') }} --"
                });

                //  select2 scripts for select2 deals field
                $(".select2-field-deals").select2({
                    placeholder: "-- {{ 'SELECT DEALS' | trans({}, 'mailsbackend') }} --"
                });

                $('#btn-mails-send').click(function () {
                    // retrieving values of email of destinations
                    var registeredValue = $(".select2-field-registered").val();
                    var subscribedValue = $(".select2-field-subscribed").val();
                    var customAddressValue = $(".selectize-custom-address").val();
                    var groupValue = $(".select2-field-group").val();
                    var categoryValue = $(".select2-field-category").val();

                    // retrieving message content from summernote
                    var messageContent = $('.note-editable').html();
                    var textmessageContent = $('.note-editable').text();
                    $('#frontend_bundle_mails_send_message').html(messageContent);

//                    alert(textmessageContent);

                    // verifying issues in email sending
                    if (registeredValue == null
                            && subscribedValue == null
                            && customAddressValue.length <= 0
                            && groupValue.length <= 0
                            && categoryValue == null
                    ) {                                                             // if no email destination selected
                        $('#flashbag-block').html(
                                '<div class="alert alert-danger fade in">'
                                + '<button class="close" type="button" data-dismiss="alert" aria-hidden="true">×</button>'
                                + '<span class="fa fa-exclamation-triangle"></span>'
                                + '{{ 'You must choice one recipient address at least.' | trans({}, 'mailsbackend') }}'
                                + '</div>'
                        );
                        return false;
                    } else if(textmessageContent == null || textmessageContent == '') {     // if message content is null
                        $('#flashbag-block').html(
                                '<div class="alert alert-danger fade in">'
                                + '<button class="close" type="button" data-dismiss="alert" aria-hidden="true">×</button>'
                                + '<span class="fa fa-exclamation-triangle"></span>'
                                + '{{ 'You must write the content of the message.' | trans({}, 'mailsbackend') }}'
                                + '</div>'
                        );
                        return false;
                    } else {
                        return true;
                    }
                });

                //  iCheck scripts for checkboxes and radiosfield
                $('.i-checks').iCheck({
                    checkboxClass: 'icheckbox_square-green',
                    radioClass: 'iradio_square-green',
                });

                //  Summernote scripts for textareas
                $('.summernote').summernote({
                    toolbar: [
                        ['style', ['bold', 'italic', 'underline', 'clear']],
                        ['fontsize', ['fontsize']],
                        ['color', ['color']],
                        ['para', ['ul', 'ol', 'paragraph']],
                        ['insert', ['link', 'table']]
                    ]
                });
            });

        </script>
    {% endblock %}
