{% extends 'BackendBundle::layout.html.twig' %}

{% block custom_css %}
    {{ parent() }}


    <!-- iCheck Styles -->
    <link rel="stylesheet" href="{{ asset('bundles/backend/css/plugins/iCheck/custom.css') }}"
          type="text/css"/>

    <!-- select2 Styles -->
    <link rel="stylesheet" href="{{ asset('bundles/backend/css/plugins/select2/select2.min.css') }}"
          type="text/css"/>

    <!-- codemirror Styles -->
    <link rel="stylesheet" href="{{ asset('bundles/backend/css/plugins/codemirror/codemirror.css') }}"
          type="text/css"/>
    <link rel="stylesheet" href="{{ asset('bundles/backend/js/plugins/codemirror/addon/hint/show-hint.css') }}"
          type="text/css"/>
    <link rel="stylesheet" href="{{ asset('bundles/backend/css/plugins/codemirror/dracula.css') }}"
          type="text/css"/>

{% endblock %}

        {% block active_post %}active{% endblock %}

        {% block page_heading_title %}
            <a class="btn btn-default navbar-btn" href="{{ path('post') }}"
               style="margin-bottom: 7px;">
                <span class="glyphicon glyphicon-chevron-up"></span>
            </a>
            Post creation
        {% endblock %}

        {% block page_content %}

            {{ form_start(form, {'attr': {'class':'form-horizontal'}}) }}

            <div class="tabs-container">
                <ul id="post-tabs" class="nav nav-tabs">
                    <li class="active">
                        <a data-toggle="tab" href="#post-basic" aria-expanded="true">Basic Data</a>
                    </li>
                    <li class="">
                        <a data-toggle="tab" href="#post-optional-metas" aria-expanded="false">Optional Metas</a>
                    </li>
                    <li class="">
                        <a data-toggle="tab" href="#post-custom-css" aria-expanded="false">Custom CSS</a>
                    </li>
                    <li class="">
                        <a data-toggle="tab" href="#post-custom-js" aria-expanded="false">Custom JS</a>
                    </li>
                </ul>

                <div class="tab-content">
                    <div id="post-basic" class="tab-pane active">
                        <div class="panel-body">

                            <div class="form-group{% if(form.title.vars['errors']|length > 0) %} {{ ' has-error' }} {% endif %}">
                                <label for="" class="col-md-2 control-label">{{ form_label(form.title) }}</label>

                                <div class="col-md-6">
                                    {{ form_widget(form.title, { 'attr': {'class' : 'form-control'}}) }}
                                    {% if form.title.vars['errors']|length > 0 %}
                                        <ul class="message">
                                            {% for error in form.title.vars['errors'] %}
                                                <li>{{ error.message }}</li>
                                            {% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>

                            <div class="form-group{% if(form.route.vars['errors']|length > 0) %} {{ ' has-error' }} {% endif %}">
                                <label for="" class="col-md-2 control-label">{{ form_label(form.route) }}</label>

                                <div class="col-md-6">
                                    {{ form_widget(form.route, { 'attr': {'class' : 'form-control'}}) }}
                                    {% if form.route.vars['errors']|length > 0 %}
                                        <ul class="message">
                                            {% for error in form.route.vars['errors'] %}
                                                <li>{{ error.message }}</li>
                                            {% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>

                            <div class="form-group{% if(form.content.vars['errors']|length > 0) %} {{ ' has-error' }} {% endif %}">
                                <label for="" class="col-md-2 control-label">{{ form_label(form.content) }}</label>

                                <div class="col-md-8">
                                    {{ form_widget(form.content, { 'attr': {'class' : 'form-control'}}) }}
                                    {% if form.content.vars['errors']|length > 0 %}
                                        <ul class="message">
                                            {% for error in form.content.vars['errors'] %}
                                                <li>{{ error.message }}</li>
                                            {% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>

                            <div class="form-group{% if(form.published.vars['errors']|length > 0) %} {{ ' has-error' }} {% endif %}">
                                <label for="" class="col-md-2 control-label">{{ form_label(form.published) }}</label>

                                <div class="col-md-1">
                                    <div class="checkbox-inline">
                                        {{ form_widget(form.published, { 'attr': {'class' : 'form-control i-checks'}}) }}
                                        {% if form.published.vars['errors']|length > 0 %}
                                            <ul class="message">
                                                {% for error in form.published.vars['errors'] %}
                                                    <li>{{ error.message }}</li>
                                                {% endfor %}
                                            </ul>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>

                            <div class="form-group{% if(form.metaTitle.vars['errors']|length > 0) %} {{ ' has-error' }} {% endif %}">
                                <label for="" class="col-md-2 control-label">{{ form_label(form.metaTitle) }}</label>

                                <div class="col-md-6">
                                    {{ form_widget(form.metaTitle, { 'attr': {'class' : 'form-control'}}) }}
                                    {% if form.metaTitle.vars['errors']|length > 0 %}
                                        <ul class="message">
                                            {% for error in form.metaTitle.vars['errors'] %}
                                                <li>{{ error.message }}</li>
                                            {% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>

                            <div class="form-group{% if(form.metaKeywords.vars['errors']|length > 0) %} {{ ' has-error' }} {% endif %}">
                                <label for="" class="col-md-2 control-label">{{ form_label(form.metaKeywords) }}</label>

                                <div class="col-md-6">
                                    {{ form_widget(form.metaKeywords, { 'attr': {'class' : 'form-control'}}) }}
                                    {% if form.metaKeywords.vars['errors']|length > 0 %}
                                        <ul class="message">
                                            {% for error in form.metaKeywords.vars['errors'] %}
                                                <li>{{ error.message }}</li>
                                            {% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>

                            <div class="form-group{% if(form.metaDescription.vars['errors']|length > 0) %} {{ ' has-error' }} {% endif %}">
                                <label for=""
                                       class="col-md-2 control-label">{{ form_label(form.metaDescription) }}</label>

                                <div class="col-md-6">
                                    {{ form_widget(form.metaDescription, { 'attr': {'class' : 'form-control'}}) }}
                                    {% if form.metaDescription.vars['errors']|length > 0 %}
                                        <ul class="message">
                                            {% for error in form.metaDescription.vars['errors'] %}
                                                <li>{{ error.message }}</li>
                                            {% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="hr-line-dashed"></div>

                            <div class="form-group{% if(form.author.vars['errors']|length > 0) %} {{ ' has-error' }} {% endif %}">
                                <label for=""
                                       class="col-md-2 control-label">{{ form_label(form.author) }}</label>

                                <div class="col-md-6">
                                    {{ form_widget(form.author, { 'attr': {'class' : 'form-control select2-field', 'style' : 'width: 100%'}}) }}
                                    {% if form.author.vars['errors']|length > 0 %}
                                        <ul class="message">
                                            {% for error in form.author.vars['errors'] %}
                                                <li>{{ error.message }}</li>
                                            {% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>

                        </div>
                    </div>

                    <div id="post-optional-metas" class="tab-pane">
                        <div class="panel-body">

                            <div class="form-group{% if(form.optionalMetas.vars['errors']|length > 0) %} {{ ' has-error' }} {% endif %}">
                                <div class="col-md-12">
                                    {{ form_widget(form.optionalMetas, { 'attr': {'class' : 'form-control'}}) }}
                                    {% if form.optionalMetas.vars['errors']|length > 0 %}
                                        <ul class="message">
                                            {% for error in form.optionalMetas.vars['errors'] %}
                                                <li>{{ error.message }}</li>
                                            {% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>

                        </div>
                    </div>

                    <div id="post-custom-css" class="tab-pane">
                        <div class="panel-body">

                            <div class="form-group{% if(form.customCss.vars['errors']|length > 0) %} {{ ' has-error' }} {% endif %}">
                                <div class="col-md-12">
                                    {{ form_widget(form.customCss, { 'attr': {'class' : 'form-control'}}) }}
                                    {% if form.customCss.vars['errors']|length > 0 %}
                                        <ul class="message">
                                            {% for error in form.customCss.vars['errors'] %}
                                                <li>{{ error.message }}</li>
                                            {% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>

                        </div>
                    </div>

                    <div id="post-custom-js" class="tab-pane">
                        <div class="panel-body">

                            <div class="form-group{% if(form.customJs.vars['errors']|length > 0) %} {{ ' has-error' }} {% endif %}">
                                <div class="col-md-12">
                                    {{ form_widget(form.customJs, { 'attr': {'class' : 'form-control'}}) }}
                                    {% if form.customJs.vars['errors']|length > 0 %}
                                        <ul class="message">
                                            {% for error in form.customJs.vars['errors'] %}
                                                <li>{{ error.message }}</li>
                                            {% endfor %}
                                        </ul>
                                    {% endif %}
                                </div>
                            </div>

                        </div>
                    </div>
                </div>


                <div class="form-group m-t p-m">
                    <div class="col-md-2 text-right">
                        <a class="btn btn-success" href="{{ path('post') }}">
                            <span class="glyphicon glyphicon-chevron-left"></span>
                            Back to the list
                        </a>
                    </div>
                    <div class="col-md-10">

                        {{ form_widget(form.submit, { 'attr': { 'class' : 'btn btn-primary btn-small', }}) }}
                        {{ form_widget(form.submitback, { 'attr': { 'class' : 'btn btn-primary btn-small', }}) }}

                        {{ form(form) }}

                    </div>
                </div>
            </div>



            {{ form_end(form) }}

        {% endblock %}

    {% block custom_js %}
        {{ parent() }}

        <!-- iCheck Scripts -->
        <script src="{{ asset('bundles/backend/js/plugins/iCheck/icheck.min.js') }}"
                type="text/javascript"></script>

        <!-- select2 Scripts -->
        <script src="{{ asset('bundles/backend/js/plugins/select2/select2.full.min.js') }}"
                type="text/javascript"></script>

        <!-- codemirror Scripts -->
        <script src="{{ asset('bundles/backend/js/plugins/codemirror/codemirror.js') }}"
                type="text/javascript"></script>

        <script src="{{ asset('bundles/backend/js/plugins/codemirror/addon/selection/active-line.js') }}"
                type="text/javascript"></script>
        <script src="{{ asset('bundles/backend/js/plugins/codemirror/addon/edit/matchbrackets.js') }}"
                type="text/javascript"></script>

        <script src="{{ asset('bundles/backend/js/plugins/codemirror/addon/hint/css-hint.js') }}"
                type="text/javascript"></script>
        <script src="{{ asset('bundles/backend/js/plugins/codemirror/addon/hint/html-hint.js') }}"
                type="text/javascript"></script>
        <script src="{{ asset('bundles/backend/js/plugins/codemirror/addon/hint/javascript-hint.js') }}"
                type="text/javascript"></script>
        <script src="{{ asset('bundles/backend/js/plugins/codemirror/addon/hint/show-hint.js') }}"
                type="text/javascript"></script>
        <script src="{{ asset('bundles/backend/js/plugins/codemirror/addon/hint/xml-hint.js') }}"
                type="text/javascript"></script>

        <script src="{{ asset('bundles/backend/js/plugins/codemirror/mode/javascript/javascript.js') }}"
                type="text/javascript"></script>
        <script src="{{ asset('bundles/backend/js/plugins/codemirror/mode/css/css.js') }}"
                type="text/javascript"></script>
        <script src="{{ asset('bundles/backend/js/plugins/codemirror/mode/vbscript/vbscript.js') }}"
                type="text/javascript"></script>
        <script src="{{ asset('bundles/backend/js/plugins/codemirror/mode/xml/xml.js') }}"
                type="text/javascript"></script>
        <script src="{{ asset('bundles/backend/js/plugins/codemirror/mode/htmlmixed/htmlmixed.js') }}"
                type="text/javascript"></script>
    {% endblock %}

    {% block inline_js %}
        <script type="text/javascript">

            var editorContent;
            function initEditorContent() {
                if (editorContent instanceof CodeMirror) {
                    editorContent.refresh();
                } else {
                    var mixedMode = {
                        name: "htmlmixed",
                        scriptTypes: [{
                            matches: /\/x-handlebars-template|\/x-mustache/i,
                            mode: null
                        },
                            {
                                matches: /(text|application)\/(x-)?vb(a|script)/i,
                                mode: "vbscript"
                            }]
                    };
                    editorContent = CodeMirror.fromTextArea(document.getElementById("backendbundle_post_content"), {
                        mode: mixedMode,
                        lineNumbers: true,
                        matchBrackets: true,
                        styleActiveLine: true,
                        lineWrapping: true,
                        foldGutter: true,
                        gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
                        extraKeys: {"Ctrl-Space": "autocomplete"},
                        theme: "dracula"
                    });
                    editorContent.setSize('100%', 500);
                }
            }

            var editorMetas;
            function initEditorMetas() {
                if (editorMetas instanceof CodeMirror) {
                    editorMetas.refresh();
                } else {
                    var mixedMode = {
                        name: "htmlmixed",
                        scriptTypes: [{
                            matches: /\/x-handlebars-template|\/x-mustache/i,
                            mode: null
                        },
                            {
                                matches: /(text|application)\/(x-)?vb(a|script)/i,
                                mode: "vbscript"
                            }]
                    };
                    editorMetas = CodeMirror.fromTextArea(document.getElementById("backendbundle_post_optionalMetas"), {
                        mode: mixedMode,
                        lineNumbers: true,
                        matchBrackets: true,
                        styleActiveLine: true,
                        lineWrapping: true,
                        foldGutter: true,
                        gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
                        extraKeys: {"Ctrl-Space": "autocomplete"},
                        theme: "dracula"
                    });
                    editorMetas.setSize('100%', 400);
                }
            }

            var editorCSS;
            function initEditorCSS() {
                if (editorCSS instanceof CodeMirror) {
                    editorCSS.refresh();
                } else {
                    editorCSS = CodeMirror.fromTextArea(document.getElementById("backendbundle_post_customCss"), {
                        mode: "css",
                        lineNumbers: true,
                        matchBrackets: true,
                        styleActiveLine: true,
                        lineWrapping: true,
                        foldGutter: true,
                        gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
                        extraKeys: {"Ctrl-Space": "autocomplete"},
                        theme: "dracula"
                    });
                    editorCSS.setSize('100%', 400);
                }
            }

            var editorJS;
            function initEditorJS() {
                if (editorJS instanceof CodeMirror) {
                    editorJS.refresh();
                } else {
                    editorJS = CodeMirror.fromTextArea(document.getElementById("backendbundle_post_customJs"), {
                        mode: "javascript",
                        lineNumbers: true,
                        matchBrackets: true,
                        styleActiveLine: true,
                        lineWrapping: true,
                        foldGutter: true,
                        gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
                        extraKeys: {"Ctrl-Space": "autocomplete"},
                        theme: "dracula"
                    });
                    editorJS.setSize('100%', 400);
                }
            }


            $(document).ready(function () {


                //  iCheck scripts for checkboxes and radios
                $(".i-checks").iCheck({
                    checkboxClass: "icheckbox_square-green",
                    radioClass: "iradio_square-green",
                });


                //  select2 scripts for batch actions combobox
                $(".select2-field").select2({
                    placeholder: "--- Select a value ---"
                });

                //  codemirror
                // Only load editors if tab has been clicked
                initEditorContent();
                $('#post-tabs > li > a[href="#post-basic"]').on('shown.bs.tab', function (e) {
                    initEditorContent();
                });
                $('#post-tabs > li > a[href="#post-optional-metas"]').on('shown.bs.tab', function (e) {
                    initEditorMetas();
                });
                $('#post-tabs > li > a[href="#post-custom-css"]').on('shown.bs.tab', function (e) {
                    initEditorCSS();
                });
                $('#post-tabs > li > a[href="#post-custom-js"]').on('shown.bs.tab', function (e) {
                    initEditorJS();
                });

            });
        </script>
    {% endblock %}
